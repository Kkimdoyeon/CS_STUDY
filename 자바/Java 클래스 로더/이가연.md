# Class Loader

클래스 로더는 자바 컴파일러가 컴파일한 바이트 코드를 런타임 영역에 `동적로딩`하고 `링크`하는 역할을 한다. <br>
클래스 로더의 역할은 크게 3가지로 나뉜다. 

- 로딩
  - 바이틀 코드를 런타임의 메소드 영역에 저장한다.
  - 이때 로드된 클래스를 포함해 부모 클래스, 인터페이스, 변수, 메소드 등이 저장된다. 
- 링크
  - 바이트 코드를 **검증**하고 적절한 데이터 구조를 **준비**해 실제 레퍼런스로 **분석**한다. 
- 초기화
  - 정적 변수를 초기화한다.
 
![image](https://github.com/dlrkdus/CS_STUDY/assets/99721126/18c63910-3c56-4332-8a56-fc83c343ec3d)

이때 클래스 로더는 3가지 종류가 있다. <br>

- 부트스트랩 클래스 로더
- 확장 클래스 로더
- 시스템 클래스 로더

### 부트스트랩 클래스 로더

JVM 시작시 최초로 실행되는 클래스 로더이다. <br>
자바 클래스가 아닌 최소한의 자바 클래스와 자바 클래스를 로드할 수 있는 자바 자체 클래스 로더를 로드한다. <br>
Java8에선 jre/lib/rt.jar 및 기타 핵심 라이브러리와 같은 JDK의 내부 클래스를 로드하였지만, <br>
Java9부턴  ClassLoader 내 최상위 클래스들만 로드한다. <br>

### 확장 클래스 로더

확장 클래스 로더는 부트스트랩 클래스 로더의 자식 클래스로서 확장 자바 클래스들을 로드한다.<br>
java.ext.dirs 환경 변수에 설정된 디렉토리의 클래스 파일을 로드하고, 이 값이 설정되어 있지 않은 경우 ${JAVA_HOME}/jre/lib/ext 에 있는 클래스 파일을 로드한다. <br>
Java8에선 URLClassLoader를 상속하고 jre/lib/ext 내 모든 클래스를 로드하였지만, <br>
Java9부턴 Platform Loader로 변경되었으며, BuiltinClassLoader를 상속한다. <br>

### 시스템(애플리케이션) 클래스 로더

우리가 만든 .class 확장자 파일을 로드한다. <br>

## 클래스 로더 동작방식

![image](https://github.com/dlrkdus/CS_STUDY/assets/99721126/202c921f-5501-4087-b1ac-66d2d04ae6d2)


1. 클래스 로더는 JVM의 메소드 영역에 클래스가 로드되어 있는지 확인한다. 로드되어있다면 해당 클래스를 사용하고, 없다면 **시스템 클래스 로더에 클래스 로드를 요청**한다.
2. 시스템 클래스 로더는 확장 클래스 로더에 요청을 위임한다.
3. 확장 클래스 로더는 부트스트랩 클래스 로더에 요청을 위임한다.
4. 부트스트랩 클래스 로더는 부트스트랩 Classpath에 해당 클래스가 있는지 확인하고, 존재하지 않다면 확장 클래스 로더에게 요청을 넘긴다.
5. 확장 클래스 로더는 확장 Classpath(JDK/JRE/LIB/EXT)에 해당 클래스가 있는지 확인하고, 존재하지 않다면 시스템 클래스 로더에게 요청을 넘긴다.
6. 시스템 클래스 로더는 시스템 Classpath에 해당 클래스가 있는지 확인하고, 존재하지 않다면 **ClassNotFoundException**을 발생시킨다.

## 클래스 로더가 지켜야 하는 3가지 원칙

- ### 위임원칙
  - 클래스 로더가 클래스를 요청 받으면 상위 클래스에게 요청을 위임한다.
- ### 가시범위 원칙
  - 하위 클래스 로더는 상위 클래스 로더가 로드한 클래스를 볼 수 있지만, 반대로 상위 클래스 로더는 하위 클래스 로더가 로드한 클래스를 알 수도, 사용할 수도 없다.
- ### 유일성의 원칙
  - 위임원칙을 기반으로 하는데, 상위 클래스에게 책임을 위임했으므로 하위 클래스 로더는 상위 클래스 로더에게 로드한 클래스를 다시 로드하지 않아야 한다.
 
## 동적 클래스 로딩 

자바의 클래스 로딩은 클래스 참조 시점에 JVM에 코드가 링크되고, 실제 런타임 시점에 로딩되는 동적 로딩을 거친다. <br>
JVM이 **미리 모든 클래스에 대한 정보를 메소드 영역에 로딩하지 않는다**는 것이다. <br>
동적 로딩에는 두 가지 방식이 있다. <br>

### 1. 로드 타임 동적 로딩 

하나의 클래스를 로딩하는 과정에서 동적으로 다른 클래스를 로딩한다.

### 2. 런타임 동적 로딩

로딩 될 때가 아닌 코드를 실행하는 순간에 클래스를 로딩한다. 

### 동적 로딩의 장단점

- 장점
  - 모든 클래스를 로드하지 않음으로써, JVM에서는 메모리를 효율적으로 관리할 수 있게 된다.
- 단점
  - 동적 로딩은 컴파일 시점에는 오류가 있는지 알 수 없다.
  - 또한, 모든 클래스가 로딩되어 있지 않기 때문에, 동적 로딩에 시간이 추가적으로 필요하기 때문에 프로그램 성능 저하로 이어질 수 있다.
 






#### 출처

https://steady-coding.tistory.com/593 <br>
https://velog.io/@ddangle/Java-%ED%81%B4%EB%9E%98%EC%8A%A4-%EB%A1%9C%EB%8D%94%EB%9E%80


