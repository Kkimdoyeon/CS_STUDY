# 교착상태 (Deadlock)

## 의미 

- 시스템 자원에 대한 요구가 뒤엉킨 상태
- 프로세스가 자원을 얻지 못해 다음 처리를 하지 못하는 상태
- 둘 이상의 프로세스가 다른 프로세스가 점유하고 있는 자원을 서로 기다릴 때 무한 대기에 빠지는 상황
- 시스템적으로 한정된 자원을 여러 곳에서 사용하려고 할 때 발생

<br/>

## 발생조건

- **상호 배제 (Mutual Exclusion)**
    - 한 번에 프로세스 하나만 해당 자원을 사용 가능
    - 용 중인 자원을 다른 프로세스가 사용하려면 요청한 자원이 해제될 때까지 기다려야 핳ㅁ
- **점유 대기 (Hold and Wait)**
    - 자원을 최소한 하나 보유하고 다른 프로세스에 할당된 자원을 점유하기 위해 대기하는 프로세스가 존재해야 함
    - 즉 최소한 하나의 자원을 점유하고 있으면서 다른 프로세스에 할당되어 사용되고 있는 자원을 추가로 점유하기 위해 대기하는 프로세스가 있어야 함
- **비선점 (No preemption)**
    - 이미 할당된 자원을 강제로 빼앗을 수 없음
- **순환 대기 (Circular wait)**
    - 대기 프로세스의 집합이 순환 형태로 자원을 대기하고 있어야 함
    - 프로세스의 집합에서 P0은 P1이 점유한 자원을 대기하고 P1은 P2가 점유한 자원을 대기하고, P2...Pn-1d은 Pn이 점유한 자원을 대기하며 Pn은 P0이 점유한 자원을 요구해야 함

<br/>

## 해결법

- 데드락이 발생하지 않도록 예방(prevention) 하기
- 데드락 발생 가능성을 인정하면서도 적절하게 회피(avoidance) 하기
- 데드락 발생을 허용하지만 데드락을 탐지(detection)하여 데드락에서 회복하기

<br/>

## 예방 (Prevention)

- **발생조건 4가지 중 하나라도 발생하지 않게 하는 것**
- 스템의 처리량이나 효율성을 떨어트리는 단점이 발생할 수 있음
- **자원의 상호 배제 조건 방지 / 상호 배제 부정**
    - 한 번에 여러 프로세스가 공유 자원을 사용할 수 있게 함
    - 여러 개의 프로세스가 동시에 공유자원을 사용할 수 있음
- **점유 대기 조건 방지 / 점유 대기 부정**
    - 프로세스가 실행되기 전에 필요한 모든 자원을 할당하여 프로세스 대기를 없애거나 자원이 점유되지 않은 상태에서만 자원 요청을 받도록 함
    - 프로세스 실행에 필요한 모든 자원을 한꺼번에 요구하고 허용할 때까지 작업을 보류
    - 나중에 또다른 자원을 점유하기 위한 대기 조건을 성립하지 않도록 함
- **비선점 조건 방지 / 비선점 부정**
    - 모든 자원에 대한 선점을 허용
    - 이미 다른 프로세스에게 할당된 자원이 선점권이 없다고 가정할 때 높은 우선순위의 프로세스가 해당 자원을 선점할 수 있도록 함
- **순환 대기 조건 방지 / 순환 대기 부정**
    - 자원을 순환 형태로 대기하지 않도록 일정한 한 쪽 방향으로만 자원을 요구할 수 있도록 함
    - 자원을 선형으로 분류하여 고유 번호를 할당하고 각 프로세스는 현재 점유한 자원의 고유번호보다 앞이나 뒤 한쪽 방향으로만 자원을 요구하도록 함

<br/>

## 회피 (Avoidance)

- 교착상태가 발생할 가능성이 있는 자원 할당(Unsafe allocation)을 하지 않고 안전한 상태(Safe state)에서만 자원 요청을 허용하는 방법
- 가정 (필요) : 
    - 프로세스 수 고정
    - 자원의 종류와 수 고정
    - 프로세스가 요구하는 최대 자원의 수를 알아야 함
    - 프로세스는 자원 사용 후 반드시 반납
- **안정 상태(safe state)**
    - safe sequence(교착상태를 발생시키지 않고 자원을 할당하는 순서)가 존재하며 모든 프로세스가 정상적으로 종료될 수 있는 상태를 의미
    - 시스템의 프로세스들이 요청하는 모든 자원을 데드락을 발생시키지 않으면서도 차례로 모두에게 할당해 줄 수 있다면 안정 상태(safe state)에 있다고 함
- **안전 순서(safe sequence)**
    - 특정한 순서로 프로세스들에게 자원을 할당, 실행 및 종료 등의 작업을 할 때 데드락이 발생하지 않는 순서를 찾을 수 있다면 안전 순서(safe sequence)라고 함
- **불안정 상태(Unsafe state)**
    - 안정 상태가 아닌 상황
    - 데드락 발생 가능성이 있는 상황
    - 불안정 상태일 때 발생할 수 있음
    - 불안정 상태가 교착 상태보다 좀 더 큰 집합
    - 회피 알고리즘은 자원을 할당한 후에도 시스템이 항상 Safe state에 있을 수 있도록 할당을 허용하자는 것이 기본 특징


<br/>
<br/>
<br/>

### 참고 자료

- https://cocoon1787.tistory.com/858
- https://velog.io/@dl_edge/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-%EA%B5%90%EC%B0%A9%EC%83%81%ED%83%9C-4%EA%B0%80%EC%A7%80-%EC%A1%B0%EA%B1%B4
- https://chanhuiseok.github.io/posts/cs-2/
