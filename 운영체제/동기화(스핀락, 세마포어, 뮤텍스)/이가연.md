# 동기화

![image](https://github.com/dlrkdus/CS_STUDY/assets/99721126/5b793496-5986-4672-bbe1-d82225955c6a)

가상 메모리의 장점 중 하나로 메모리의 공유를 들었다. 그런데 메모리를 공유할 때는 한 가지 큰 고민점이 있다. <br>
바로 **여러 프로세스가 동시에 공유 메모리에 접근할 때**이다. 이것을 **경쟁 상태(Race Condition)** 이라 한다. <br>
경쟁 상태의 문제점은 어떤 프로세스가 공유 메모리에 먼저 접근하냐에 따라 **똑같은 코드라도 결과값이 바뀐다**는 점이다. <br>
이것에 대한 해결책이 **동기화**이다. <br>

## 임계 구역과 상호배제 

동기화의 가장 기본적인 로직은 **쓰레드(프로세스 실행단위)의 순차적인 실행**을 보장해주는 것이다. <br>
이것은 화장실에 비유하면 이해하기 쉽다. 우리는 화장실 한 칸에 사람 한 명이 들어가서 볼일을 본다. <br>
프로세스도 마찬가지다. 한 번에 하나의 프로세스만 실행할 것이다. <br>
운영체제에서는 이 화장실을 **임계구역(Critical Section)**, 그리고 한 명씩 들어가는 것을 **상호배제(mutually exclusive)** 라고 한다. 

### 임계 구역 ( Critical Section )

임계 구역을 화장실에 비유했다. 여러 프로세스들이 동시에 접근하려는 **공유 자원**이다. <br>
즉 임계 구역은 공유하고 있는 변수가 있는, 그래서 경쟁 상태를 유발할 수 있는 코드 조각이다. <br>
임계 구역 해결 알고리즘은 다음 세 가지의 조건을 만족해야 유효하다. <br>

- **Mutual Exclusive ( 상호 배제 )**
  - 하나의 자원에는 하나의 프로세스(쓰레드)만 접근 가능하다.
- **Progress ( 진행 )**
  - 임계 구역이 비었을 때만 이용 가능하다. ( Deadlock Free )
- **Bounded Waiting (한계 대기)**
  - 프로세스가 임계 구역에 들어가기 위해 무한 대기에 빠지면 안된다. (프로세스가 기아에 빠지면 안된다 : Starvation Free)
 
임계 구역은 일반적으로 다음과 같은 구조를 지닌다.

```

do{
  /*
  entry section ( 진입구역 )
  */

  /*
  critical section ( 임계구역 )  
  */

  /*
  exit section ( 퇴출구역 )
  */

  /*
  remainder section ( 나머지구역 )
  */
} while(True)

```

로직에 따라 작성한 구조는 이러하다. <br>

```

do{
  wants[i] = true; // i 프로세스가 공유 자원을 사용하겠다고 선언
  while(wants[j]) {;} // j 프로세스가 사용중이면 진입 불가 ( 진입구역 )
    CRITICAL SECTION ( 임계구역 )
  wants[i] = false; // i 프로세스가 공유 자원 사용 완료 후 반납 ( 퇴출구역 )
    REMAINDER SECTION ( 나머지구역 )
} while(True)

```




