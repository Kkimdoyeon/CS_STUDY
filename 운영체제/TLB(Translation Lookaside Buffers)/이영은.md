# TLB(Translation Lookaside Buffers)

가상메모리 기법은 메모리 참조시, 논리주소를 동적으로 물리주소로 변환하여 참조한다. 최소 두 번의 참조가 발생한다. 

1) 페이지 테이블 참조, 2) 실기억장치 참조, 두 번의 참조는 두 배의 메모리 접근 시간이 걸리도록 만든다. 이 문제를 해결하기 위해 TLB, 즉 고속 캐시를 사용한다. 

## TLB

TLB는 컴퓨터 시스템의 가상 메모리 관리에서 중요한 역할을 하는 캐시의 한 형태이다. 가장 최근에 사용된 가상 주소와 그에 해당하는 물리적 주소 매핑을 저장하여, 가상 주소를 물리적 주소로 변환하는 과정의 효율성을 높인다. 일종의 캐싱과 같다. 

TLB는 고속캐시이다. 즉, 하드웨어다. TLB는 병렬판독회로(하드웨어)가 있어 원하는 페이지를 단번에 찾을 수 있다. 이를 연관사상이라 한다. 굉장히 빠르다. 

가장 최근에 참조된 페이지를 TLB에 저장한다. 특정 페이지가 필요시, 먼저 TLB를 검사한다. 적중(HIT)하면 바로 물리주소로 변환하여 주기억장치에 접근한다. 적중(HIT)하지 않으면 OS는 페이지 테이블을 검사해야 한다. 

만약 페이지 테이블에도 없다면, 페이지 폴드 처리 루틴을 수행해야 한다. 

운영체제는 CPU에게 페이지를 반입(Fetch)하도록 명령한다. CPU는 입출력장치를 활성화시키고 디스크에서 주기억장치로 페이지를 전송한다. 만약 주기억장치가 가득찼다면, 페이지 교체가 수행된다. 페이지가 주기억장치에 할당되면 페이지 테이블을 갱신한다. 

다시 CPU는 TLB검사를 한다. TLB에는 아직 페이지 정보가 없다. 페이지 테이블을 검사하면 새로 반입된 페이지가 존재한다. 새로 참조된 페이지이므로 TLB를 갱신한다. CPU가 논리주소를 물리주소로 변환하면 과정은 끝이 난다. 

### 기능

**주소 변환 가속화** : TLB는 가상 주소를 물리적 주소로 변환하는 과정을 가속화한다. 페이지 테이블을 매번 조회하는 대신, TLB는 최근에 사용된 주소 변환을 빠르게 제공한다. 

**효율적인 메모리 접근** : TLB를 사용함으로써 메모리 접근 시간이 단축되고, 시스템의 전반적인 성능이 향상된다. 

**페이지 테이블 오버헤드 감소** : TLB는 페이지 테이블 접근 횟수를 줄여, 페이지 테이블로 인한 오버헤드를 감소시킨다. 

### 원리

1. TLB 조회: 프로세스가 메모리에 접근할 때, 시스템은 먼저 TLB에서 해당 가상 주소의 매핑을 조회한다. 
2. 히트와 미스 : TLB미스가 발생하면, 시스템은 페이지 테이블을 조회하여 필요한 주소 변환을 수행한다. 이후, 이 매핑은 TLB에 저장되어 향후 접근을 가속화한다. 
3. TLB업데이트 : TLB는 제한된 크기를 가지므로, 새로운 주소 매핑이 추가될 때, 오래된 매핑을 교체한다. 

### 중요성

- TLB는 메모리 접근 시간을 크게 줄여주는 중요한 요소이다. 특히, 페이지 테이블이 여러 레벨로 구성된 복잡한 시스템에서 TLB의 역할은 더욱 중요하다.
- TLB는 시스템의 성능에 직접적으로 영향을 미치기에 TLB의 크기와 관리 전략은 시스템 설계에서 중요한 고려 사항이다.

📚 출처

- https://lordofkangs.tistory.com/244
- https://velog.io/@wrld_worthy/CS-Translation-Lookaside-BufferTLB