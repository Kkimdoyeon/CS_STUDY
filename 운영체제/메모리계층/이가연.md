# 메모리 계층 
![image](https://github.com/dlrkdus/CS_STUDY/assets/99721126/34a48000-4080-4008-b637-1fca12a267e7)

컴퓨터에는 다양한 저장 장치가 존재하며,<br>
이 중에서 CPU가 고속으로 접근 할 수 있는 저장장치를 메모리(**주기억장치**),<br>
그 외 부가적인 저장장치를 **보조기억장치**라고 한다.<br>
이러한 저장장치들을 필요에 따라 **CPU가 적절히 꺼내쓰도록 계층적으로 구성**하는 것을 메모리 계층이라 한다.<br>

## 메모리의 지역성
  ### 시간적 지역성
  최근에 참조된 데이터나 명령어는 곧 다시 참조될 가능성이 높은 현상을 의미한다. <br>
  예시로 반복문을 들 수 있다.<br>
  ### 공간적 지역성 
  한 번 참조된 데이터나 명령어와 인접한 위치에 있는 데이터나 명령어가 곧 다시 참조될 가능성이 높은 현상을 의미한다.<br>
  예시로 배열의 연속적 접근을 들 수 있다.<br>

  **이러한 지역성을 이용하여 자주 사용되거나 사용될 확률이 높은 데이터를 캐시로 관리해 시스템의 성능을 향상시킬 수 있다.**
  <br>
  
  
## 메모리 계층 구성 

![image](https://github.com/dlrkdus/CS_STUDY/assets/99721126/a0982922-ee3d-4317-be8f-cc2c7fcc863e)

메모리층은 레지스터, 캐시, 주기억장치, 보조장치로 구성되며 순서대로 CPU의 접근 속도가 빠르다. 

|명칭|위치|접근속도|기억용량|휘발성여부|
|------|---|---|---|---|
|레지스터|CPU 내부|가장 빠름|가장 적음|휘발성|
|캐시|CPU 내부|빠름|적음|휘발성|
|메모리(주기억장치)|CPU 외부|보통|보통|휘발성|
|하드 디스크(보조기억장치)|CPU 직접 접근 불가|낮음|많음|비휘발성|

<hr>

### 레지스터 

레지스터는 CPU 내에 위치하는 작고 빠른 속도의 메모리이다.<br>
CPU와 함께 동작함으로써 메모리 중 속도가 가장 빠르지만 용량이 작다.<br>
레지스터는 일반적으로 데이터 레지스터, 주소 레지스터, 명령어 레지스터, 상태 레지스터로 분류된다.<br>

- **데이터 레지스터<br>**
  연산에 필요한 데이터를 임시저장하는 레지스터
- **주소 레지스터<br>**
  주소 지정에 사용될 메모리 주소를 저장하는 레지스터
- **명령어 레지스터<br>**
  현재 CPU가 실행해야할 명령어를 저장하는 레지스터
- **상태 레지스터<br>**
  제어 흐름을 관리하는 레지스터

<hr>

### 캐시 

캐시 메모리는 CPU와 주메모리 사이에 위치하는 작고 빠른 속도의 메모리이다.<br>
속도가 빠른 장치와 느린 장치 사이에서 속도차에 따른 병목 현상을 완화해줄 수 있다.<br>
**메모리의 지역성**을 활용해 CPU가 자주 사용하는 명령어나 데이터를 임시로 저장하는데 사용된다.<br>
속도는 빠르지만 마찬가지로 용량은 작다.<br>

#### 캐시 메모리 종류

- 레벨1 캐시(L1)<br>
  - CPU 코어에 내장돼 가장 빠르게 접근할 수 있는 캐시
- 레벨2 캐시(L2)<br>
  - 레벨1 캐시 바로 뒤에 위치하며 모든 코어에서 공유된다. <br> 레벨1보단 느리지만 용량이 더 높다.
- 레벨3 캐시(L3)<br>
  - 여러 코어에서 공유되며 레벨2보단 느리지만 용량이 더 높다.
 
#### 캐싱 라인

캐시의 데이터를 쉽게 찾기 위해 캐시에 저장되는 특별한 자료구조이다.

- **Direct Mapping**<br>
  - 메인 메모리를 일정한 크기의 블록으로 나누어 각각의 블록을 캐시의 정해진 위치에 매핑하는 방식이다.<br>
-  **Full Associative Mapping**<br>
  - 캐시 메모리의 빈 공간에 마음대로 주소를 저장하는 방식이다. <br>
- **Set Associative Mapping**<br>
  - Direct Mapping과 Full Associative Mapping의 장점을 결합한 방식으로 <br>
    빈 공간에 마음대로 주소를 저장하되, 미리 정해둔 특정 행에만 저장한다.

#### 캐싱 미스

CPU가 참조하려는 데이터가 캐시 메모리에 없을 때 발생한다.

<hr>

### 주기억장치

- **RAM**<br>
전원이 종료되면 저장 내용이 삭제되는 휘발성 저장장치이다. <br>
빠른 속도, 효율적인 용량 관리, 저렴한 비용, 저전력 등의 특징을 가진다. <br>

  - **SRAM**<br>
    정적 메모리로 속도가 빠르고 가격이 비싸 주로 레지스터나 캐시에 사용된다.
  - **DRAM**<br>
    주로 말하는 주기억장치(RAM)는 DRAM이다. 동적 메모리로 대용량에 저렴하다.


### 보조기억장치 

비휘발성 메모리로 CPU의 직접적 접근이 불가하며 <br>
응용프로그램이 직접 접근하거나 시스템 콜로 접근해야한다.<br>
접근 시간이 아주 느리지만 대용량이다.

- **HDD**
  크기가 크고 속도가 느리며 대용량이다. 소음이 심하다. <br>
  
- **SSD**
  크기가 작고 속도가 매우 빠르며 대개 HDD보다 용량이 작지만 최근에는 대용량도 많이 나온다. 가격이 비싸다.<br>
  
- **디스크**

#### 보조기억장치 VS 주기억장치

- 주기억장치는 CPU의 직접적인 접근이 가능하지만 보조기억장치는 불가능하다.
- 주기억장치는 CPU의 연산에 직접적으로 참여하지만 보조기억장치는 데이터의 저장만 가능하다.
- 주기억장치가 보조기억장치보다 접근 속도가 빠르다.
- 보조기억장치의 용량이 주기억장치보다 높다.
  
#### 출처
https://github.com/devSquad-study/2023-CS-Study/blob/main/OS/os_memory_hierarchy.md
https://rebro.kr/180
