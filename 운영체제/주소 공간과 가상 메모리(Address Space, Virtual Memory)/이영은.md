# 주소 공간과 가상 메모리

# 주소공간

- 프로그램이 실행되면 프로세스 주소 공간이 Memory에 할당되어진다. 할당된 프로세스를 CPU가 실행시킨다.

### 메모리 영역

1) 코드 영역(TEXT) : 프로그램 함수들의 코드를 CPU가 해석 가능한 기계어로 저장되어 있다. 코드 영역은 실행 파일을 구성하는 명령어들이 올라가는 메모리 영역으로 함수, 제어문, 상수 등이 여기에 지정된다. 컴파일 타임에 결정되고 중간에 코드를 바꿀 수 없게 Read - Only 로 지정되어 있다. 

2) 데이터 영역(DATA) : 코드의 전역변수나 각종 데이터들이 모여 있다. 프로그램이 구동되는 항상 접근 가능한 변수가 저장되는 영역이다. 전역 변수, static 값을 참조한 코드는 컴파일 하고 나면 Data 영역의 주소값을 가르키도록 바뀐다. 데이터 영역은 프로그램의 시작과 함께 할당되며, 프로그램이 종료되면 소멸한다. 실행 중도에 전역변수가 변경 될 수도 있으니 이 영역은 Read-Write로 지정되어 있다. 

3) 스택 영역(STACK) : 지역 변수와 같은 호출한 함수가 종료되면 되돌아올 임시적인 자료를 저장하는 독립적인 공간이다. Stack은 함수의 호출과 함께 할당되고 완료되면 소멸한다. 컴파일 타임에 크기가 결정되기 때문에 무한히 할당 할 수 없다. 재귀함수가 너무 깊게 호출되거나 함수가 지역변수를 너무 많이 가지고 있어 stack 영역을 초과하면 stack overflow에러가 발생한다. 

4) 힙 영역(HEAP) : 런타임에 크기가 결정되는 메모리 영역이다. 사용자에 의해 메모리 공간이 동적으로 할당되고 해제된다. 참조형의 데이터의 값이 저장됩니다. 예를 들어 클래스, 클로저가 이 부분에 해당된다. Heap은 메모리의 낮은 주소에서 높은 주소의 방향으로 할당된다. 

### 주소공간을 분리시키는 이유

1. 프로세스의 구역을 나눈 이유
    1. 최대한 데이터를 공유하여 메모리 사용량을 줄이기 위해 나눈다. 
    2. Code는 같은 프로그램 자체에서는 모두 같은 내용이기에 따로 관리하여 공유한다. 예를 들면 같은 프로그램을 여러개 띄울때 Code 영역을 공유할 수 있습니다. 
    3. Stack과 데이터는 스택 구조의 특성과 전역 변수의 활용성을 이용하기 위해 나눈다. 
2. Code 부분을 따로 분리하는 이유
    1. 같은 프로그램의 프로세스일 경우, 코드 부분을 공유하여 메모리 사용량을 줄이는 목적입니다. 
3. Stack과 Data 부분을 따로 나누는 이유
    1. Stack의 구조는 하단이 막혀있고 상단만 뚫려있어, 한 쪽으로만 데이터를 넣고 꺼낼 수 있다. 꺼낼 때는 최근의 데이터부터 꺼낼 수 밖에 없는 구조입니다. 이러한 Stack구조로 인해 Data 부분과 Stack부분을 따로 나누게 되었습니다. 
    2. 전역변수는 어떤 함수에서도 접근 할 수 있기에 Data로 따로 관리해줍니다. 
    3. 따라서 함수 외부와 함수(지역변수 포함)에 따라서 Stack구조 활용을 위해 나눈 것이다. 

---

# 가상 메모리

- 운영체제는 메모리가 실제 메모리보다 많아 보이게 하는 기술인 가상 메모리를 제공합니다. 이로 인해 물리적 메모리의 한계에도 불구하고 더 많은 양을 가진 프로그램들을 실행시킬 수 있습니다.
- 가상 메모리는 시스템이 프로그램을 실행시키는 데 최소한 얼마만큼의 메모리가 필요한가에 대한 접근 방식으로, 실행에 필요한 일부분만 메모리에 로드하고 나머지는 디스크에 두고서 필요할 때마다 교체하면서 쓰는 방식으로 구현됩니다.

### 가상 메모리의 장점

1. 메인 메모리를 하드 디스크의 캐시로 처리하여 더 넓은 메모리 공간을 제공합니다. 즉, 임시 데이터를 하드 디스크 드라이브에 저장하고 필요에 따라 기본 메모리로 가져올 수 도 있습니다. 
2. 메모리 크기의 제약으로부터 자유로워졌고, 사용자 프로그램이 실행에 필요한 최소 크기의 메모리만 올라가져 있기에 더 많은 프로그램을 동시 수행 가능해졌습니다. 
3. 추가 권한 비트를 사용하여 각 프로세스에 메모리에 대한 제한된 액세스 권한을 부여하여 메모리를 보호합니다. OS는 권한 비트를 확인하여 한 프로세스가 다른 프로세스의 메모리 공간을 손상시키지 않도록 할 수 있습니다. 

📚 출처

- [https://velog.io/@heeco/CS-프로세스-주소공간](https://velog.io/@heeco/CS-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-%EC%A3%BC%EC%86%8C%EA%B3%B5%EA%B0%84)
- [https://velog.io/@wngud4950/CS운영체제OS-가상-메모리-Virtual-Memory](https://velog.io/@wngud4950/CS%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9COS-%EA%B0%80%EC%83%81-%EB%A9%94%EB%AA%A8%EB%A6%AC-Virtual-Memory)