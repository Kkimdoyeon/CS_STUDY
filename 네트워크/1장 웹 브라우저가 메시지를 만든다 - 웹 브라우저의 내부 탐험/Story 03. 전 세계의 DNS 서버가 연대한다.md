# DNS 서버의 기본 동작

![image](https://github.com/user-attachments/assets/d9e1327d-8fb2-4916-8be4-34009e509440)


DNS 서버의 기본 동작은 ***클라이언트에서 조회 메시지를 받고 조회의 내용에 응답하는 형태로 정보를 회답*** 하는 것이다. 

이 조회 메시지의 주요 구성 요소는 다음과 같다. 

- **이름**
    - 메일 주소에서 @ 뒤와 같은 이름
- **클래스**
    - 인터넷 네트워크를 나타내는 `IN` 이라는 클래스
- **타입**
    - 이름에 어떤 타입의 정보가 지원되는지 나타낸다.
    - `A` : 이름에 IP 주소가 지원된다.
    - `MX` : 이름에 메일 배송 목적지가 지원된다.
    - 이 외에도 PT, R, CNAME, NS, SOA 타입 등이 있다.

# 도메인의 계층

DNS 서버에 모든 서버 정보를 등록해놓을 순 없다. 만약 조회하려는 서버 정보가 DNS 서버에 없는 경우는 어떻게 될까? 

![image](https://github.com/user-attachments/assets/d10ecde6-1b35-4d68-8ce8-f6149ca8589f)


***정보를 분산시켜서* `다수의 DNS 서버`*에 등록하고, 다수의 DNS 서버가* `연대`*하여 어디에 정보가 등록되어 있는지를 찾아낸다.*** 

도메인은 `계층적 구조`를 지닌다. 예시를 통해 보자. 


> 💡
> **www.cyber.co.kr**
> 1. **kr** 
>     1. 대한민국에 할당된 도메인
> 2. **co**
>     1. 국내의 도메인을 분류하기 위해 설치된 도메인 회사 
> 3. **cyber**
>     1. 회사에 할당된 도메인 
> 4. **www**
>     1. 서버 이름 

**즉, 각 도메인은 섹션별로 나누어져 있고 해당 섹션을 관리하는 각각의 DNS 서버가 존재한다.**

# 담당 DNS 서버를 찾아 IP 주소를 가져온다.

인터넷에는 DNS 서버가 수만 대 있으므로 모든 서버를 살펴보면서 원하는 정보를 가져올 수는 없다. 그래서 아래와 같은 방법을 사용한다.

먼저 하위의 도메인을 담당하는 DNS 서버의 IP 주소를 그 상위의 DNS 서버에 등록한다. 그리고 상위의 DNS 서버를 또 그 상위의 DNS 서버에 등록하는 식으로 차례대로 등록한다. 그러면 **상위의 DNS 서버에 가면 하위의 DNS 서버의 IP 주소를 알 수 있게 된다.**

계층별 DNS 서버를 좀 더 자세히 살펴보자. 

![image](https://github.com/user-attachments/assets/118e9ae8-608c-4e9f-98f1-88da51d94769)

## 루트 DNS 서버

- 도메인의 가장 최상단에 위치한 섹션은 루트 도메인이다. **`.`** 이지만 일반적으로 브라우저에서는 생략된다. 사실 www.example.com의 진짜 도메인은 www.example.com**.** 인 것이다.
- 루트 DNS 서버는 전세계 **13대**로 분산되어있으며 최상위 계층을 관리하며 **최상위 도메인(`TLD`) 서버의 주소를 제공한다.**

## 최상위 도메인 (TLD) 서버

- `com`, `org`, `net` 같은 **최상위 도메인**(TLD)은 도메인의 두 번째 계층에 위치한다. 각 TLD는 그에 해당하는 TLD DNS 서버에 의해 관리된다.
- 예를 들어, .com 도메인은 .com TLD 서버에서 관리하고, .kr 도메인은 .kr TLD 서버에서 관리한다.
- TLD 서버는 다음 계층인 **2차 도메인 (SLD) 주소를 제공한다.**

## 2차 도메인 서버 ( Authoritative DNS)

- naver.com 에서 `naver`는 2차 도메인이다.
- 2차 도메인은 각 도메인 소유자나 DNS 호스팅 업체에 의해 설정된다.
- 2차 도메인 서버(권한 있는 네임서버) 는 **도메인의 IP 주소와 서브도메인에 대한 정보를 제공한다.**

## 서브 도메인

- 도메인의 가장 하위 섹션으로 도메인 이름 앞에 추가되는 식별자 (`www` 등)

**즉, 루트 도메인부터 하위 도메인을 타고 내려가면서 일치하는 정보를 찾아 해당 DNS 서버에서 IP 주소를 가져오는 것이다.** 

# **DNS 서버는 캐시 기능으로 빠르게 회답할 수 있다.**

DNS 서버의 가장 강력한 기능은 캐싱 기능이다. 

**DNS 서버는 한 번 조사한 이름을 캐시에 기록한다.** 

따라서 조회한 이름에 해당하는 정보가 캐시에 있으면 해당 정보를 빠르게 회신하고, 없으면 계층 구조 DNS로 향한다. 

이러한 캐시 기능은 주의할 점이 있는데, 캐시에 등록된 정보가 변경될 수도 있다. 따라서 캐시 유효 기간을 정해놓고 유효 기간이 지나면 캐시에서 삭제한다. 

만약 캐싱을 통해 조회할 경우 응답 받은 정보가 캐시에 저장된 것인지 아니면 DNS 서버에서 응답한 것인지 알려준다.
